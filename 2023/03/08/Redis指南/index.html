

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <meta name="baidu-site-verification" content="code-O81KxcQEvT" />
  <link rel="apple-touch-icon" sizes="76x76" href="/gallery/paw_img.jpg">
  <link rel="icon" href="/gallery/paw_img.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="PPLong">
  <meta name="keywords" content="">
  <!--添加百度站点统计-->
  <meta name="baidu-site-verification" content="code-O8Xoj3awJS" />
  <!-- 谷歌网址前缀站点统计 http://www.pplong.top -->
  <meta name="google-site-verification" content="Mp6W6JCXOdt66_GIaboJrilKmC9VI0DOWE4W2d1PMRQ" />
  <meta name="description" content="Redis指南 概念 Redis: 内存告诉缓存数据库，全称为: Remote Dictionary Server(C语言编写), 是一个Key-Value存储系统。可用于缓存，事件发布、订阅、高速队列等场景。基于内存且可持久化。 特点  读写性能优异 数据类型丰富。支持String、List、Set等数据类型的操作 原子性。所有操作都是原子性的 持久化。支持RDB、AOF等持久化方式 单线程">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis指南">
<meta property="og:url" content="https://www.pplong.top/2023/03/08/Redis%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="PPLong的博客">
<meta property="og:description" content="Redis指南 概念 Redis: 内存告诉缓存数据库，全称为: Remote Dictionary Server(C语言编写), 是一个Key-Value存储系统。可用于缓存，事件发布、订阅、高速队列等场景。基于内存且可持久化。 特点  读写性能优异 数据类型丰富。支持String、List、Set等数据类型的操作 原子性。所有操作都是原子性的 持久化。支持RDB、AOF等持久化方式 单线程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pdai.tech/images/db/redis/db-redis-object-2-2.png">
<meta property="og:image" content="https://pdai.tech/images/db/redis/db-redis-object-2-2.png">
<meta property="og:image" content="https://cdn.xiaolincoding.com//mysql/other/4eeef4dd1bedd2ffe0b84d4eaa0dbdea-20230309232249413.png">
<meta property="og:image" content="https://cdn.xiaolincoding.com//mysql/other/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0ODI3Njc0,size_16,color_FFFFFF,t_70-20230309231944807.png">
<meta property="og:image" content="https://pdai.tech/images/db/redis/db-redis-sub-3.svg">
<meta property="og:image" content="https://pdai.tech/images/db/redis/db-redis-sub-5.svg">
<meta property="og:image" content="https://pdai.tech/images/db/redis/db-redis-sub-10.svg">
<meta property="article:published_time" content="2023-03-08T07:53:16.000Z">
<meta property="article:modified_time" content="2023-04-09T13:25:16.000Z">
<meta property="article:author" content="PPLong">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="NoSQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://pdai.tech/images/db/redis/db-redis-object-2-2.png">
  
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script> <script>LA.init({id: "Jf1FrphVHSZkysQl",ck: "Jf1FrphVHSZkysQl"})</script>
  
  <title>Redis指南 - PPLong的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      
        
          
          
          
        
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css" />
      
      
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/indexing-hover.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_3317616_gaxkom6hjqm.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.pplong.top","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":4},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"9MuBWVsFJbGBbwW0dLf4PCir-MdYXbMMI","app_key":"ufhGMao9OY41YN3la9fN7NI0","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 90vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>PPLong的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友達
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-link-fill"></i>
                娱乐
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/movie/">
                    <i class="iconfont icon-movie"></i>
                    第二人生
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/shuoshuo/">
                    <i class="iconfont icon-comment"></i>
                    唠唠
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/develop/">
                    <i class="iconfont icon-codepen-fill"></i>
                    尝鲜
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/gallery/covers/wallhaven-lm5w9r.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Redis指南">
              
            </span>

            
              <div class="mt-3">
    
            
                <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-03-08 15:53" pubdate>
        始于: 2023年3月8日下午3点53分
      </time>
    </span>
                
</div>

<!-- 自定义的更新时间 -->
<div class="mt-1">
    
        <span class="post-meta">
  <i class="iconfont icon-clipcheck" aria-hidden="true"></i>
  <time datetime="2023-04-09 21:25" pubdate>
    更新: 2023年4月9日晚上9点25分
  </time>
</span>
        
</div>

<div class="mt-1">
    
        <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.2k 字
    </span>
        

            
                <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      26 分钟
    </span>
                

                    
                        
                            
                                <!-- LeanCloud 统计文章PV -->
                                <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span>
                                 次
                                    </span>
                                    
                                                
</div>
            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

    <div class="container-fluid nopadding-x">
        <div class="row nomargin-x">
            <div class="d-none d-lg-block col-lg-2"></div>
            <div class="col-lg-8 nopadding-x-md">
                <div class="container nopadding-x-md" id="board-ctn">
                    <div class="py-5" id="board">
                        <article class="post-content mx-auto">
                            <!-- SEO header -->
                            <h1 style="display: none">
                                Redis指南
                            </h1>
                            
                                    <div class="markdown-body">
                                        <h1>Redis指南</h1>
<h2 id="概念-v9">概念</h2>
<p>Redis: 内存告诉缓存数据库，全称为: Remote Dictionary Server(C语言编写), 是一个Key-Value存储系统。可用于缓存，事件发布、订阅、高速队列等场景。基于内存且可持久化。</p>
<h3 id="特点">特点</h3>
<ul>
<li>读写性能优异</li>
<li>数据类型丰富。支持String、List、Set等数据类型的操作</li>
<li>原子性。所有操作都是原子性的</li>
<li>持久化。支持RDB、AOF等持久化方式</li>
<li><strong>单线程</strong></li>
</ul>
<h3 id="相关应用">相关应用</h3>
<ul>
<li>热点数据缓存</li>
<li>限时业务使用</li>
<li>计数器相关数据</li>
<li>延时操作</li>
<li>排行榜(SortedSet)</li>
<li>好友等相互关系的存储</li>
</ul>
<h2 id="基本-v3">基本</h2>
<h3 id="基本数据类型">基本数据类型</h3>
<table>
<thead>
<tr>
<th>结构类型</th>
<th>结构存储的值</th>
<th>结构的读写能力</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>String字符串</strong></td>
<td>可以是字符串、整数或浮点数</td>
<td>对整个字符串或字符串的一部分进行操作；对整数或浮点数进行<strong>自增</strong>或<strong>自减</strong>操作；</td>
</tr>
<tr>
<td><strong>List列表</strong></td>
<td>一个链表，链表上的每个节点都包含一个字符串</td>
<td>对链表的两端进行push和pop操作(队列或栈)，两端都可以进行pop或者push，读取单个或多个元素；根据值查找或删除元素；</td>
</tr>
<tr>
<td><strong>Set集合</strong></td>
<td>包含字符串的无序集合(非重复)</td>
<td>字符串的集合，包含基础的方法有看是否存在添加、获取、删除；还包含计算交集、并集、差集等</td>
</tr>
<tr>
<td><strong>Hash散列</strong></td>
<td>包含键值对的无序散列表</td>
<td>包含方法有添加、获取、删除单个元素</td>
</tr>
<tr>
<td><strong>Zset有序集合</strong></td>
<td>和散列一样，用于存储键值对(非重复)。有double类型的分数</td>
<td>字符串成员与浮点数分数之间的有序映射；元素的排列顺序由分数的大小决定；包含方法有添加、获取、删除单个元素以及根据分值范围或成员来获取元素</td>
</tr>
</tbody>
</table>
<h3 id="特殊数据类型">特殊数据类型</h3>
<ul>
<li>
<p><strong>HyperLogLogs基数统计</strong></p>
<ul>
<li>什么是基数：A = {1, 2, 3, 4, 5}， B = {3, 5, 6, 7, 9}；那么基数（不重复的元素）= 1, 2, 4, 6, 7, 9； （允许容错，即可以接受一定误差）</li>
<li><strong>解决什么问题？</strong>：省内存去统计各种计数(注册IP数、每日访问IP数、页面实时UV、用户每天搜索不同词条的个数、在线用户数等)，不会保存元数据只会记录数量。每个HyperLogLog Key占用12KB的内存用于标记基数</li>
</ul>
</li>
<li>
<p><strong>Bitmap</strong>位存储</p>
<ul>
<li>**解决问题：**统计用户活跃和不活跃数量、登陆/未登录等仅有两个状态的(例如存储一年的登陆状态只需要46Byte左右)</li>
</ul>
</li>
<li>
<p><strong>Geospatial地理位置</strong></p>
<ul>
<li>存储：经度+维度</li>
</ul>
</li>
<li>
<p><strong>Stream消息队列</strong></p>
<ul>
<li>相比于基于List类型实现的消息队列，能够自动生成全局唯一消息ID，支持以消费组形式消费数据</li>
</ul>
</li>
</ul>
<h3 id="Redis对象机制">Redis对象机制</h3>
<p><img src="https://pdai.tech/images/db/redis/db-redis-object-2-2.png" alt=""></p>
<p><strong>Redis为什么要设计RedisObject对象</strong></p>
<p>Redis中一些命令只能用于特定的键，所以需要为不同类型的键设置不同的处理方式，所以Redis必须让每个键都带有类型信息。比如集合类型可以由字典和整数集合两种不同的数据结构实现，但用户执行ZADD时，他不应关系集合使用的是哪种类型。</p>
<p>Redis构建了自己的类型系统，主要有以下功能:</p>
<ul>
<li>构建redisObject对象</li>
<li>基于redisObject对象的类型检查</li>
<li>基于redisObject对象的显式多态函数</li>
<li>对redisObject进行分配、共享和销毁机制</li>
</ul>
<p><strong>redisObject组成</strong></p>
<div class="code-wrapper"><pre class="language-c++" data-language="c++"><code class="language-c++">&#x2F;&#x2F; type:记录对象保存的值的类型
#define OBJ_STRING 0 &#x2F;&#x2F; 字符串
#define OBJ_LIST 1 &#x2F;&#x2F; 列表
#define OBJ_SET 2 &#x2F;&#x2F; 集合
#define OBJ_ZSET 3 &#x2F;&#x2F; 有序集
#define OBJ_HASH 4 &#x2F;&#x2F; 哈希表

&#x2F;&#x2F; encoding:对象所保存的值的编码
#define OBJ_ENCODING_RAW 0     &#x2F;* Raw representation *&#x2F;
#define OBJ_ENCODING_INT 1     &#x2F;* Encoded as integer *&#x2F;
#define OBJ_ENCODING_HT 2      &#x2F;* Encoded as hash table *&#x2F;
#define OBJ_ENCODING_ZIPMAP 3  &#x2F;* 注意：版本2.6后不再使用. *&#x2F;
#define OBJ_ENCODING_LINKEDLIST 4 &#x2F;* 注意：不再使用了，旧版本2.x中String的底层之一. *&#x2F;
#define OBJ_ENCODING_ZIPLIST 5 &#x2F;* Encoded as ziplist *&#x2F;
#define OBJ_ENCODING_INTSET 6  &#x2F;* Encoded as intset *&#x2F;
#define OBJ_ENCODING_SKIPLIST 7  &#x2F;* Encoded as skiplist *&#x2F;
#define OBJ_ENCODING_EMBSTR 8  &#x2F;* Embedded sds string encoding *&#x2F;
#define OBJ_ENCODING_QUICKLIST 9 &#x2F;* Encoded as linked list of ziplists *&#x2F;
#define OBJ_ENCODING_STREAM 10 &#x2F;* Encoded as a radix tree of listpacks *&#x2F;

typedef struct redisObject &#123;
    &#x2F;&#x2F; 对象所保存的值的类型
    unsigned type:4;
    &#x2F;&#x2F; 对象所保存的值的编码
    unsigned encoding:4;
    &#x2F;&#x2F; LRU - 24位, 记录最末一次访问时间（相对于lru_clock）; 或者 LFU（最少使用的数据：8位频率，16位访问时间）
    unsigned lru:LRU_BITS; &#x2F;&#x2F; LRU_BITS: 24
    &#x2F;&#x2F; 引用计数
    int refcount;
    &#x2F;&#x2F; 指向底层数据结构实例
    void *ptr;

&#125; robj;</code></pre></div>
<p><img src="https://pdai.tech/images/db/redis/db-redis-object-2-2.png" alt="Redis6.0数据、编码类型与底层数据结构的映射关系"></p>
<p><strong>Redis处理一条命令的过程</strong></p>
<ol>
<li>根据给定的key, 在数据库字典中查找和他对应的redisObject，没找到就返回NULL</li>
<li>检查redisObject的type属性和执行命令所需的类型是否相符(比如说插入的值的类型是字符串)，否则返回错误</li>
<li>根据redisObject encoding属性指定的编码，选择合适的操作函数来处理底层的数据结构</li>
<li>返回操作结果值</li>
</ol>
<p><strong>对象共享与引用计数</strong></p>
<p>redis一般把一些常见的值放到一个共享对象中，避免重复分配，但<strong>只能共享字符串对象</strong>。</p>
<p>每个redisObject都有一个引用计数属性</p>
<p>新创建一个对象时，refcount为1.对一个对象进行共享时refcount++, 使用完一个对象后refcount–.当refcount==0时，该redisObject将会被销毁</p>
<h2 id="特点-v2">特点</h2>
<h3 id="持久化">持久化</h3>
<blockquote>
<p>Redis关闭后按理来说数据会丢失，那么Redis如何实现持久化的？</p>
</blockquote>
<p><strong>Redis如何实现持久化？</strong></p>
<p>三种方式: AOF日志、RDB快照、混合持久化方式</p>
<h4 id="AOF日志">AOF日志</h4>
<p>Redis执行完一条操作命令后就会降命令追加写入到一个文件中，Redis重启时，会读取该文件记录，逐一执行命令进行数据恢复。</p>
<p><strong>先执行命令，再把数据写入日志</strong></p>
<p>这样的方式可能带来以下的影响:</p>
<ul>
<li>避免额外开销：如果当前命令有语法错误，那么就无法执行，自然也就不会写入到日志中了。但如果先写入日志再执行，那就需要最后再根据执行情况来判断是否要删除日志中的记录</li>
<li>数据可能丢失：在操作命令完成但还未开始写入日志时发生宕机，这时候就数据未写入日志中(但数据已经完成更新)，后续重启时无法恢复</li>
</ul>
<p><strong>AOF写回过程</strong></p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/4eeef4dd1bedd2ffe0b84d4eaa0dbdea-20230309232249413.png" alt=""></p>
<ol>
<li>Redis执行完操作后，将命令追加到server.aof_buf缓冲区</li>
<li>执行write系统调用，将缓冲区数据写入到AOF文件中(此时数据只是到了内核缓冲区，还需要等待内核将数据写入硬盘)</li>
<li>内核缓冲区掘洞数据何时被写入硬盘</li>
</ol>
<p>对于<strong>缓冲区数据写入硬盘的时机</strong>，Redis提供三种策略(与fsync()有关)：</p>
<ul>
<li>Always：操作命令执行完后总是将AOF日志数据写回硬盘，性能开销大</li>
<li>Everysec：每次操作命令执行完后，先将命令写入到AOF文件的内核缓冲区，然后每隔一秒将缓冲区的内容写回到硬盘。宕机时丢失1秒内的数据</li>
<li>No：Redis不控制缓冲区数据写回到硬盘的时机</li>
</ul>
<p><strong>AOF文件过大后该怎么办: AOF重写机制</strong></p>
<p>随着操作命令越来越多，AOF文件肯定越来越大，重启后则需要花费更多时间来恢复，因此Redis为了避免AOF文件越写越大，提供<strong>AOF重写机制</strong>。当AOF文件大小超过阈值时，就会由后台子进程<code>bgrewriteaof</code>通过AOF重写机制来压缩AOF文件</p>
<p><strong>具体步骤</strong></p>
<p>在重写时，读取当前数据库的所有键值对，将每一个键值对用一条命令记录到新的AOF文件中，然后替换旧的AOF文件。(也就是<strong>抹除历史</strong>，不会再保存以前更改的记录，只保存最新值的记录)。例如之前使用<code>set name zyl</code>与<code>set name PPLong</code> ，重写后就只有<code>set name PPLong</code>这一条指令。</p>
<blockquote>
<p><strong>为什么AOF重写机制采用子进程进行？不采用线程？</strong></p>
<ul>
<li>首先子进程进行AOF重写期间，主进程可以继续处理请求而不会被阻塞</li>
<li>如果使用线程，多线程间会共享内存，则就存在线程间可见性的问题，修改共享内存数据时需要加锁来保证数据安全，从而会降低效率。由于父子进程是共享内存数据(只读方式)，当父子进程任意一方修改了共享内存，就会发生<code>写时复制——COW</code>, 于是父子进程就有了独立的数据副本，不用来保证数据安全。(这里写时复制COW属于OS的内容，对主进程会造成阻塞，可以先参考这篇文章理解<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jelly12345/p/15223184.html">《Redis写时拷贝（COW）总结》</a>。简单理解为子进程最初与父进程共享页表，只有父亲、子进程要写入时子进程才会复制并开辟另一块内存空间)</li>
</ul>
</blockquote>
<p><strong>AOF引发的数据不一致问题</strong></p>
<p>如果在重写过程中，主进程修改了已经存在的key-value，此时这个key-value数据在子进程的内存数据就跟在主进程的内存数据不一致了，如何处理？</p>
<p>为此Redis设置了一个<strong>AOF重写缓冲区</strong>：在重写AOF期间，每当Redis执行完一个写命令后，Redis会将该条命令同时写入到<strong>AOF缓冲区</strong>和<strong>AOF重写缓冲区</strong>。当子进程完成AOF重写后，向主进程发送完成信号，主进程接受到信号后，会将AOF重写缓冲区等待所有内容追加到新的AOF文件中，使得新旧两个AOF文件保存到数据库状态一致，将新的AOF文件覆盖旧的AOF文件。</p>
<p><img src="https://cdn.xiaolincoding.com//mysql/other/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0ODI3Njc0,size_16,color_FFFFFF,t_70-20230309231944807.png" alt=""></p>
<h4 id="RDB快照">RDB快照</h4>
<p>实质：记录某一时刻的内存数据，恢复数据时效率更高，只需要把RDB文件读入内存即可</p>
<p>生成RDB文件的两种命令：</p>
<ul>
<li>bgsave: 创建子进程生成RDB文件
<ul>
<li>redis可以通过配置文件自动执行bgsave，默认：</li>
<li>900 秒之内，对数据库进行了至少 1 次修改；300 秒之内，对数据库进行了至少 10 次修改；60 秒之内，对数据库进行了至少 10000 次修改。</li>
</ul>
</li>
<li>save: 主线程运行，生成RDB文件，会阻塞主线程</li>
</ul>
<p>每次保存的快照都是<strong>全量快照</strong>，即把内存中的所有数据都保存到磁盘中，因此保存频率不能太频繁</p>
<p>bgsave过程中，主线程依然可以处理操作命令，关键还是使用写时复制技术COW。存在的问题式，发生COW后，RDB快照中保存的内容是之前的内存数据。如果系统恰好在RDB快照文件创建完毕后崩溃，则Redis将丢失主线程在快照期间修改的数据。</p>
<h4 id="AOF-RDB混合持久化">AOF+RDB混合持久化</h4>
<p>Redis conf下使用<code>aof-use-rdb-preamble yes</code></p>
<p><strong>AOF日志重写混合持久化过程</strong></p>
<ul>
<li>fork出的子进程与主线程共享的<strong>内存数据</strong>以RDB方式写入到AOF文件中</li>
<li>主线程在此期间处理的操作命令被记录在重写缓冲区中</li>
<li>重写缓冲区的<strong>增量命令</strong>以AOF方式写入到AOF文件</li>
</ul>
<p>也就是前半部分用RDB格式的全量数据，后半部分是AOF格式的增量数据</p>
<p><strong>优点</strong></p>
<ul>
<li>重启Redis时，前半部分(大部分数据)是RDB格式，加载速度快</li>
<li>后半部分是AOF格式，尽可能减少数据的丢失</li>
</ul>
<h3 id="发布-订阅模式">发布/订阅模式</h3>
<p>一种消息通信模式，两个角色发布者、订阅者</p>
<p>SUBSCRIBE命令可以让客户端订阅任意数量的频道，每当有新消息发送到被订阅的频道时，信息就会发送给所有订阅该频道的客户端</p>
<p>客户端执行订阅指令之后，就会进入订阅状态，之后就只能接收 <code>subscribe</code>、<code>psubscribe</code>、<code>unsubscribe</code>、<code>punsubscribe</code> 这四个命令。新订阅的客户端，是<strong>无法收到这个频道之前的消息</strong>，这是因为 Redis 并不会对发布的消息持久化的。</p>
<p>Redis的两种发布/订阅模式</p>
<ul>
<li>基于频道Channel</li>
<li>基于模式Pattern</li>
</ul>
<h4 id="基于频道Channel">基于频道Channel</h4>
<p>发布者可以向指定的频道Channel发送消息，订阅者可以从订阅的多个Chanel中接收到此消息。发出去的消息不会被持久化</p>
<div class="code-wrapper"><pre class="language-redis" data-language="redis"><code class="language-redis">&#x2F;&#x2F; 发布
publish [target_channel] [message]
&#x2F;&#x2F; 订阅(可一次订阅多个频道)
subscribe [target_channel_1] [target_channel_2] ...</code></pre></div>
<p>客户端subscribe，进入订阅状态后客户端可能收到3种类型的回复，回复由三部分组成</p>
<table>
<thead>
<tr>
<th>消息类型</th>
<th>第二部分</th>
<th>第三部分</th>
</tr>
</thead>
<tbody>
<tr>
<td>subscribe</td>
<td>订阅成功的频道的名称</td>
<td>当前客户端订阅的频道数目</td>
</tr>
<tr>
<td>message</td>
<td>产生消息的频道</td>
<td>消息的内容</td>
</tr>
<tr>
<td>unsubscribe</td>
<td>频道名称</td>
<td>当前客户端订阅的频道数目</td>
</tr>
</tbody>
</table>
<p><strong>底层: 如何实现</strong></p>
<p>通过字典实现，key为正在被订阅的频道, value为一个链表，包含所有订阅了这个频道的客户端</p>
<p>当调用 <code>publish channel message</code> 命令， 程序首先根据 channel 定位到字典的键， 然后将信息发送给字典值链表中的所有客户端。</p>
<p><img src="https://pdai.tech/images/db/redis/db-redis-sub-3.svg" alt=""></p>
<h4 id="基于模式Pattern">基于模式Pattern</h4>
<p><img src="https://pdai.tech/images/db/redis/db-redis-sub-5.svg" alt=""></p>
<p>当有信息发送到 tweet.shop.kindle 频道时， 信息除了发送给 clientX 和 clientY 之外， 还会发送给订阅 <a target="_blank" rel="noopener" href="http://tweet.shop">tweet.shop</a>.* 模式的 client123 和 client256</p>
<p>通配符中?表示1个占位符，*表示任意个占位符(包括0)，?*表示1个以上占位符。</p>
<p><strong>如何实现</strong></p>
<p>使用链表，链表中的每个节点包含订阅该模式的客户端，pattern表示当前被订阅的模式</p>
<p><img src="https://pdai.tech/images/db/redis/db-redis-sub-10.svg" alt=""></p>
<h2 id="面试-v2">面试</h2>
<h3 id="基础-v8">基础</h3>
<h4 id="Redis到底是单线程还是多线程？">Redis到底是单线程还是多线程？</h4>
<ul>
<li>Redis6.0版本前的单线程指网络IO和读写是由一个线程完成的</li>
<li>Redis6.0后引入多线程是指网络请求采用了多线程，而键值对读写命令仍然是单线程，所以Redis依然是<strong>并发安全</strong>的(其持久化喝集群数据同步等是由额外线程完成的)</li>
</ul>
<h4 id="Redis单线程为什么这么快？">Redis单线程为什么这么快？</h4>
<ol>
<li>Redis命令执行基于内存操作</li>
<li>命令执行说单线程操作，没有线程切换开销</li>
<li>基于多路复用机制提升Redis I/O利用率</li>
<li>使用高效的数据存储结构：全局Hash表、跳表、压缩列表、链表等</li>
</ol>
<h3 id="进阶-v5">进阶</h3>
<h4 id="缓存问题">缓存问题</h4>
<h5 id="缓存穿透">缓存穿透</h5>
<p>用户不断请求缓存和数据库中都没有的数据，而按规则如果从存储层查不到数据则不写入缓存，着将导致这个每次进行这个请求都要到数据库去查询，缓存失效(避免无效id查询对数据库的攻击)</p>
<p>解决方案</p>
<ul>
<li>接口层增加校验，用户鉴权校验，查询id参数进行合理性校验</li>
<li>对于缓存和数据库中都不存在的数据，将键值对记为Key-Null, 并设置缓存有效时间，防止攻击用户反复用一个id进行攻击</li>
<li>使用<strong>布隆过滤器bloomfilter</strong>，快速判断某个元素是否存在于集合中</li>
</ul>
<h5 id="缓存击穿">缓存击穿</h5>
<p>缓存中没有但数据库中有的数据(一般是缓存的数据缓存时间到期被删除), 这时如果并发用户特别多，同时缓存中没读到数据，就只能去数据库中读取，造成数据库压力过大。例如秒杀活动数据在缓存中失效，到点秒杀时，就会出现问题(属于缓存雪崩的子集)</p>
<p>解决方案</p>
<ul>
<li>设置热点数据永不过期或延长过期时间</li>
<li>重要的接口做好限流策略，防止用户恶意请求。进行降级准备，接口中某些服务不可用时，进行<strong>熔断</strong>，失败快速返回机制。</li>
<li>加互斥锁</li>
</ul>
<h5 id="缓存雪崩">缓存雪崩</h5>
<p>缓存中的数据大批量到达过期时间或Redis服务宕机，而此时查询数据量大，引起数据库压力过大。缓存击穿指并发查同一条数据，而雪崩是指很多数据都过期了</p>
<p>解决方案</p>
<ul>
<li>缓存数据的过期时间随机设置，防止大批数据同时过期</li>
<li>将热点数据均匀分布在不同的缓存数据库中</li>
<li>延长过期时间</li>
<li>互斥锁： 如果访问的的数据不在 Redis中，就加锁，保证同一时间只有一个请求构建缓存</li>
</ul>
<p>如果是Redis故障宕机而引发雪崩，可以用以下几种方案解决：</p>
<ul>
<li>服务熔断，暂停对应用业务对缓存服务的访问，直接返回错误</li>
<li>请求限流，只允许少部分请求发送到数据库进行请求</li>
<li>构建Redis集群</li>
</ul>
<h5 id="缓存污染">缓存污染</h5>
<p>缓存中一些只会被访问一次或几次的数据，之后便不会被再次访问，但其仍然留在缓存中消耗空间，时间一长后，缓存被占满了，就需要额外的开销(也就是使用Redis淘汰判断策略淘汰数据)</p>
<p><strong>缓存淘汰策略</strong></p>
<ul>
<li>不淘汰: noeviction。直接返回错误</li>
<li>对设置了过期时间的数据进行淘汰
<ul>
<li>volatile-random</li>
<li>volatile-ttl，越早过期的数据优先被选择</li>
<li>Volatile-lru，最近最少使用的原则(时间)。
<ul>
<li>Redis会记录每个数据的最近一次被访问的时间戳。在Redis在决定淘汰的数据时，第一次会随机选出 N 个数据，把它们作为一个候选集合。接下来，Redis 会比较这 N 个数据的 lru 字段，把 lru 字段值最小的数据从缓存中淘汰出去</li>
</ul>
</li>
<li>volatile-lfu，最近不经常使用(频数)。Redis 会在候选集合中，根据数据 lru 字段的后 8bit 选择访问次数最少的数据进行淘汰。当访问次数相同时，再根据 lru 字段的前 16bit 值大小，选择访问时间最久远的数据进行淘汰。</li>
</ul>
</li>
<li>全部数据进行淘汰
<ul>
<li>allkeys-random</li>
<li>allkeys-lru</li>
<li>allkeys=lfu</li>
</ul>
</li>
</ul>
<h4 id="数据库和缓存一致性">数据库和缓存一致性</h4>
<p>使用场景： Redis作为缓冲，Mysql等作为数据库</p>
<p>不管先写Mysql再更新缓存还是先更新缓存再更写Mysql都容易出现数据不一致的情况。例如：</p>
<ol>
<li>先删除缓存，正准备写数据库时，另一个线程来读取，发现缓存为空再读取数据库，此时就读到脏数据</li>
<li>先写库，正准备更新缓存，此时线程宕机了，没有删除掉缓存，也会出现不一致的情况</li>
</ol>
<p><strong>更新缓存的四种设计模式：</strong></p>
<ul>
<li>Cache aside</li>
<li>Read through</li>
<li>Write through</li>
<li>Write back</li>
</ul>
<h5 id="Cache-Aside-旁路策略">Cache Aside-旁路策略</h5>
<p>读之前先读缓存，缓存没有则读取数据库，取出数据后放入缓存中，同时返回响应；写时先更新数据库，再<strong>删除缓存(让缓存失效)</strong></p>
<p><strong>不管是先删除缓存再更新数据库还是先更新数据库再删除缓存都会造成混存和数据库数据不一致的问题！</strong></p>
<p>但是如果是先更新数据库再更新缓存，考虑以下情况:</p>
<ol>
<li>请求A要求查询数据库一个字段值(缓存中不存在)</li>
<li>查到数据但未写入缓存时，B请求更新该数据，使其自增，更新数据库的值，并清空缓存值</li>
<li>请求A将读到的旧值写入缓存中</li>
</ol>
<p>此时仍然造成了数据库与缓存不一致的问题，但是这种概率是非常小的。因为缓存的写入远快于数据库的写入，实际中很难出现请求B更新了数据库并且删除了缓存，请求A才更新完缓存的情况。可以姑且理解为执行完数据库操作后只要极少的时间就执行完缓存更新了。</p>
<p>Cache Aside适合读多写少的场景，不适合写多的场景，因为写入比较频繁时，缓存的数据将会被频繁地清理</p>
<blockquote>
<p><strong>考虑这样一个问题：如果更新数据库操作成功，但删除缓存操作失败，那此时缓存中还是旧数据，该怎么办？</strong></p>
<p>兜底策略： 设置缓存数据过期时间,但这样在数据未过期的一段时间内，数据都是脏的</p>
</blockquote>
<p><strong>如何保证写数据库和删除Redis缓存都成功？</strong></p>
<ul>
<li>重试机制(异步)</li>
<li>订阅Mysql binlog(异步)</li>
</ul>
<h5 id="重试机制">重试机制</h5>
<p>使用消息队列，将删除缓存的操作加入到消息队列，由消费者来操作数据。</p>
<p>如果应用删除缓存失败，就从消息队列中重新读取数据，然后再次删除，反复重试。成功则从消息队列中移除</p>
<p><strong>订阅Mysql binlog，再删除缓存</strong></p>
<p>由于Mysql操作一条命令成功后会产生一条日志，记录在binlog中，所以可以通过订阅这个日志文件，拿到要操作的数据，再执行缓存删除，比如阿里巴巴开源中间件Canal</p>
<p>Canal 模拟 MySQL 主从复制的交互协议，把自己伪装成一个 MySQL 的从节点，向 MySQL 主节点发送 dump 请求，MySQL 收到请求后，就会开始推送 Binlog 给 Canal，Canal 解析 Binlog 字节流之后，转换为便于读取的结构化数据，供下游程序订阅使用。</p>
<blockquote>
<p>参考文章：</p>
<p>🔗: <a target="_blank" rel="noopener" href="https://pdai.tech/">《Java全栈知识体系》</a></p>
<p>🔗: <a target="_blank" rel="noopener" href="https://xiaolincoding.com/">《小林Coding》</a></p>
<p>🔗:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jelly12345/p/15223184.html">《Redis写时拷贝（COW）总结》</a></p>
</blockquote>

                                    </div>
                                    <hr>
                                    <div>
                                        <div class="post-metas mb-3">
                                            
                                                <div class="post-meta mr-3">
                                                    <i class="iconfont icon-category"></i>
                                                    
                                                        <a class="hover-with-bg" href="/categories/Study/">
                                                            Study
                                                        </a>
                                                        
                                                </div>
                                                
                                                    
                                                        <div class="post-meta">
                                                            <i class="iconfont icon-tags"></i>
                                                            
                                                                <a class="hover-with-bg" href="/tags/SQL/">
                                                                    SQL
                                                                </a>
                                                                
                                                                <a class="hover-with-bg" href="/tags/NoSQL/">
                                                                    NoSQL
                                                                </a>
                                                                
                                                        </div>
                                                        
                                        </div>
                                        
                                            <p class="note note-warning">
                                                
                                                            本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                                                                
                                            </p>
                                            
                                                
                                                    <div class="post-prevnext">
                                                        <article class="post-prev col-6">
                                                            
                                                                
                                                                    <a href="/2023/03/15/Android-Handler%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90/">
                                                                        <i class="iconfont icon-arrowleft"></i>
                                                                        <span class="hidden-mobile">Android Handler机制解析</span>
                                                                        <span class="visible-mobile">上一篇</span>
                                                                    </a>
                                                                    
                                                        </article>
                                                        <article class="post-next col-6">
                                                            
                                                                
                                                                    <a href="/2023/02/26/Java-JUC%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">
                                                                        <span class="hidden-mobile">Java JUC源码分析</span>
                                                                        <span class="visible-mobile">下一篇</span>
                                                                        <i class="iconfont icon-arrowright"></i>
                                                                    </a>
                                                                    
                                                        </article>
                                                    </div>
                                                    
                                    </div>

                                    
                                        <!-- Comments -->
                                        <article class="comments" id="comments">
                                            
                                                        
                                                            
                                                                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'dark-blue';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'PPLong222/commit-utterances');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


                                        </article>
                                        
                        </article>
                    </div>
                </div>
            </div>
            
                <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
                    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

                </div>
                
        </div>
    </div>

    <!-- Custom -->
    
    <!--添加我自己的设置页面-->
    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
    <!--加入自定义格式的-->
    <!--自定义的git徽标样式-->
<img height="20" src="https://img.shields.io/badge/Source-Github-blue?logo=github&style=flat&logoColor=rgb(252,%2098,%2093)&color=blue">
<img height="20" src="https://img.shields.io/badge/Build-Hexo-blue?logo=hexo&style=flat&logoColor=rgb(14,%20131,%20205)&color=fc766a">
<img height="20" src="https://img.shields.io/badge/Build-Fluid-blue?logo=hexo&style=flat&logoColor=rgb(14,%20131,%20205)&color=f2c080">
<br>
<img height="20" src="https://img.shields.io/badge/蜀ICP备-2022003192号-blue?logo=data:image/png;base64,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&style=flat&color=d2c68b">

<!-- 自定义显示文章总页数和字数的模块 -->
<div class="bottom-post-statistic">
    <div class="bottom-post-count">
        72&nbsp 篇文章
    </div>
    <div class="bottom-post-word">
        319.3k&nbsp 字
    </div>
</div>
        <div class="footer-content">
             <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
        </div>

        
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


            

                
</footer>

  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  
    
  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  

  

  

  

  




  
<script src="/js/reset_code_lang.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>

  <!-- 暂时先不引入该功能 -->
  <!-- 引入JQuery -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> -->
  <!-- 引入自定义的页面访问和ip统计脚本 -->
  <!-- <script src="/js/send_req_info.js"></script> --> -->
<!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?PPLong222";
            var git_color =['#ebedf0', '#bef5cb', '#bef5cb', '#a9f5b4', '#85e89d', '#34d058', '#28a745', '#22863a', '#176f2c', '#165c26', '#144620'];
            var git_user ="PPLong222";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div id="github-calendar" style="width:100%;height:auto;padding:10px;margin-bottom:20px"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;margin-top:100px;;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/about/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:200px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style>#github_container > .position-relative > .border{border:0!important}#github-calendar{position: relative;margin-top: -2rem;background-color: var(--board-bg-color);transition: background-color 0.2s ease-in-out;border-radius: 0.5rem;z-index: 3;-webkit-box-shadow: 0 12px 15px 0 rgb(0 0 0 / 24%), 0 17px 50px 0 rgb(0 0 0 / 19%);box-shadow: 0 12px 15px 0 rgb(0 0 0 / 24%), 0 17px 50px 0 rgb(0 0 0 / 19%);}</style><!-- hexo injector body_end end --></body>
</html>
